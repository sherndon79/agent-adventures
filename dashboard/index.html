<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Adventures - Control Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/components.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <h1 class="dashboard-title">ü§ñ Agent Adventures</h1>
                <span class="dashboard-subtitle">Interactive Streaming Control Center</span>
            </div>
            <div class="header-right">
                <label class="checkbox" style="margin-right: 15px;">
                    <input type="checkbox" id="local-chat-toggle" title="When checked: Local chat only. When unchecked: Both local chat and YouTube chat enabled.">
                    <span style="margin-left: 5px;">Local Chat Only</span>
                </label>
                <button class="btn btn-small" id="settings-toggle">‚öôÔ∏è Settings</button>
                <div class="connection-status" id="connection-status">
                    <div class="status-indicator offline"></div>
                    <span>Connecting...</span>
                </div>
                <div class="system-time" id="system-time"></div>
            </div>
        </header>

        <!-- Main Content Grid -->
        <div class="dashboard-grid">
            <!-- Stream Viewer (Top Left) -->
            <section class="panel stream-panel">
                <div class="panel-header">
                    <h2 class="panel-title">üì∫ Live Stream</h2>
                    <div class="stream-controls">
                        <input type="text" id="youtube-id-input" class="input input-small" placeholder="New YouTube ID...">
                        <button class="btn btn-small btn-primary" id="update-youtube-stream">Update</button>
                        <button class="btn btn-success" id="launch-adventure">Quick Test Scene</button>
                    </div>
                </div>
                <div class="panel-content">
                    <div class="stream-container">
                        <div class="stream-player" id="stream-player">
                            <!-- YouTube stream will be loaded dynamically -->
                            <div class="stream-placeholder">
                                <div class="placeholder-icon">üì∫</div>
                                <p>Loading stream...</p>
                            </div>
                        </div>
                        <div class="stream-info">

                        </div>
                    </div>
                </div>
            </section>

            <!-- Story Loop Status (Top Right) -->
            <section class="panel story-loop-panel">
                <div class="panel-header">
                    <h2 class="panel-title">üîÑ Story Loop</h2>
                    <div class="loop-controls">
                        <button class="btn btn-success" id="start-story-loop">Start Loop</button>
                        <button class="btn btn-danger" id="stop-story-loop" disabled>Stop Loop</button>
                    </div>
                </div>
                <div class="panel-content">
                    <div class="loop-status">
                        <div class="status-row">
                            <span class="status-label">Phase:</span>
                            <span class="status-value phase-badge" id="loop-phase">Idle</span>
                        </div>
                        <div class="status-row">
                            <span class="status-label">Iteration:</span>
                            <span class="status-value" id="loop-iteration">0</span>
                        </div>
                        <div class="status-row">
                            <span class="status-label">Timer:</span>
                            <span class="status-value countdown" id="loop-timer">--</span>
                        </div>
                    </div>

                    <div class="genres-container" id="genres-container" style="display: none;">
                        <h4>üìö Current Genres</h4>
                        <div class="genres-list" id="genres-list"></div>
                    </div>

                    <div class="voting-results" id="voting-results" style="display: none;">
                        <h4>üó≥Ô∏è Voting Results</h4>
                        <div class="votes-bars" id="votes-bars"></div>
                        <div class="winner-announcement" id="winner-announcement"></div>
                    </div>

                    <div class="chat-activity" id="chat-activity">
                        <h4>üí¨ Recent Chat Activity</h4>
                        <div class="chat-messages" id="chat-messages">
                            <div class="chat-message system">Waiting for messages...</div>
                        </div>
                        <div class="local-chat-input" id="local-chat-input">
                            <input type="text" id="local-chat-message" placeholder="Type message as AgentAdventures..." />
                            <button class="btn btn-small btn-primary" id="send-local-chat">Send</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Agent Status (Top Right) -->
            <section class="panel agents-panel">
                <div class="panel-header">
                    <h2 class="panel-title">ü§ñ Agent Status</h2>
                </div>
                <div class="panel-content">
                    <div class="agent-cards" id="agent-cards">
                        <!-- Agent cards will be dynamically inserted here -->
                    </div>
                </div>
            </section>



            <!-- Token Usage & Metrics (Middle Left) -->
            <section class="panel metrics-panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìä Token Usage & Metrics</h2>
                    <div class="metrics-controls">
                        <button class="btn btn-small" id="reset-metrics">Reset</button>

                    </div>
                </div>
                <div class="panel-content">
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-title">Total Tokens</span>
                                <span class="metric-icon">üî§</span>
                            </div>
                            <div class="metric-value" id="total-tokens">0</div>
                            <div class="metric-change">+0 today</div>
                        </div>

                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-title">Estimated Cost</span>
                                <span class="metric-icon">üí∞</span>
                            </div>
                            <div class="metric-value" id="estimated-cost">$0.00</div>
                            <div class="metric-change">+$0.00 today</div>
                        </div>

                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-title">Competitions</span>
                                <span class="metric-icon">üèÜ</span>
                            </div>
                            <div class="metric-value" id="total-competitions">0</div>
                            <div class="metric-change">+0 today</div>
                        </div>

                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-title">Avg Response</span>
                                <span class="metric-icon">‚ö°</span>
                            </div>
                            <div class="metric-value" id="avg-response-time">0ms</div>
                            <div class="metric-change">-0ms vs yesterday</div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <canvas id="token-usage-chart"></canvas>
                    </div>
                </div>
            </section>

            <!-- System Health (Middle Right) -->
            <section class="panel health-panel">
                <div class="panel-header">
                    <h2 class="panel-title">üè• System Health</h2>
                    <div class="health-indicator" id="overall-health">
                        <div class="health-status healthy"></div>
                        <span>All Systems Healthy</span>
                    </div>
                </div>
                <div class="panel-content">
                    <!-- Audio Mode Control -->
                    <div class="audio-mode-control">
                        <h4 class="control-section-title">üéµ Audio Mode</h4>
                        <div class="mode-selector">
                            <button class="mode-btn active" data-mode="story" id="mode-story" title="Immersive story narration with music and ambience">
                                <span class="mode-icon">üé≠</span>
                                <span class="mode-label">Story</span>
                            </button>
                            <button class="mode-btn" data-mode="commentary" id="mode-commentary" title="Behind-the-scenes commentary with atmospheric audio">
                                <span class="mode-icon">üéôÔ∏è</span>
                                <span class="mode-label">Commentary</span>
                            </button>
                            <button class="mode-btn" data-mode="mixed" id="mode-mixed" title="Both narration and commentary with smart mixing">
                                <span class="mode-icon">üéöÔ∏è</span>
                                <span class="mode-label">Mixed</span>
                            </button>
                        </div>
                        <div class="mode-description" id="audio-mode-description">
                            Story narration with music and ambience
                        </div>
                    </div>

                    <div class="divider"></div>

                    <div class="health-services">
                        <div class="service-status" id="isaac-sim-status">
                            <div class="service-icon">üéÆ</div>
                            <div class="service-info">
                                <span class="service-name">Isaac Sim</span>
                                <span class="service-detail">Not connected (Mock Mode)</span>
                            </div>
                            <div class="service-indicator unknown"></div>
                        </div>

                        <div class="service-status" id="event-bus-status">
                            <div class="service-icon">üì°</div>
                            <div class="service-info">
                                <span class="service-name">Event Bus</span>
                                <span class="service-detail">Active</span>
                            </div>
                            <div class="service-indicator healthy"></div>
                        </div>

                        <div class="service-status" id="agents-status">
                            <div class="service-icon">ü§ñ</div>
                            <div class="service-info">
                                <span class="service-name">Agents</span>
                                <span class="service-detail">0/3 running</span>
                            </div>
                            <div class="service-indicator inactive"></div>
                        </div>

                        <div class="service-status" id="streaming-status">
                            <div class="service-icon">üì∫</div>
                            <div class="service-info">
                                <span class="service-name">Streaming</span>
                                <span class="service-detail">Not streaming</span>
                            </div>
                            <div class="service-indicator inactive"></div>
                        </div>
                    </div>

                    <div class="performance-metrics">
                        <div class="perf-metric">
                            <span class="perf-label">CPU Usage:</span>
                            <div class="perf-bar">
                                <div class="perf-fill" id="cpu-usage" style="width: 0%"></div>
                            </div>
                            <span class="perf-value" id="cpu-value">0%</span>
                        </div>

                        <div class="perf-metric">
                            <span class="perf-label">Memory:</span>
                            <div class="perf-bar">
                                <div class="perf-fill" id="memory-usage" style="width: 0%"></div>
                            </div>
                            <span class="perf-value" id="memory-value">0 MB</span>
                        </div>

                        <div class="perf-metric">
                            <span class="perf-label">Event Queue:</span>
                            <div class="perf-bar">
                                <div class="perf-fill" id="queue-usage" style="width: 0%"></div>
                            </div>
                            <span class="perf-value" id="queue-value">0</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Activity Log (Bottom) -->
            <section class="panel log-panel">
                <div class="panel-header">
                    <h2 class="panel-title">üìã Activity Log</h2>
                    <div class="log-controls">
                        <button class="btn btn-small" id="clear-log">Clear</button>
                        <select class="select select-small" id="log-level">
                            <option value="all">All Events</option>
                            <option value="competitions">Competitions</option>
                            <option value="agents">Agent Activity</option>
                            <option value="system">System Events</option>
                            <option value="errors">Errors Only</option>
                        </select>
                        <label class="checkbox">
                            <input type="checkbox" id="auto-scroll" checked>
                            Auto-scroll
                        </label>
                    </div>
                </div>
                <div class="panel-content">
                    <div class="activity-log" id="activity-log">
                        <div class="log-entry system">
                            <span class="log-time">--:--:--</span>
                            <span class="log-source">SYSTEM</span>
                            <span class="log-message">Dashboard initialized. Waiting for backend connection...</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-overlay" id="settings-overlay" style="display: none;">
        <div class="settings-modal">
            <div class="settings-header">
                <h3>‚öôÔ∏è Service Configuration</h3>
                <button class="close-btn" id="close-settings">‚úï</button>
            </div>
            <div class="settings-content">
                <div class="settings-section">
                    <h4>ü§ñ LLM APIs</h4>
                    <div class="setting-item">
                        <label class="setting-label">
                            <input type="checkbox" id="toggle-llm-apis" checked>
                            <span class="checkmark"></span>
                            Use Real LLM APIs (Claude, GPT, Gemini)
                        </label>
                        <small class="setting-description">When disabled, uses mock agent proposals</small>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>üéÆ Isaac Sim MCP</h4>
                    <div class="setting-item">
                        <label class="setting-label">
                            <input type="checkbox" id="toggle-mcp-calls" checked>
                            <span class="checkmark"></span>
                            Use Real MCP Calls to Isaac Sim
                        </label>
                        <small class="setting-description">When disabled, simulates asset placement</small>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>üì∫ Streaming</h4>
                    <div class="setting-item">
                        <label class="setting-label">
                            <input type="checkbox" id="toggle-streaming" checked>
                            <span class="checkmark"></span>
                            Use Real Streaming Services
                        </label>
                        <small class="setting-description">When disabled, mocks stream status</small>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>‚öñÔ∏è Judge Panel</h4>
                    <div class="setting-item">
                        <label class="setting-label">
                            <input type="checkbox" id="toggle-judge-panel" checked>
                            <span class="checkmark"></span>
                            Use AI Judge Panel
                        </label>
                        <small class="setting-description">When disabled, uses random winner selection</small>
                    </div>
                </div>

                <div class="settings-actions">
                    <button class="btn btn-primary" id="apply-settings">Apply Settings</button>
                    <button class="btn btn-secondary" id="reset-settings">Reset to Defaults</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/dashboard-core.js"></script>
    <script src="js/stream-viewer.js"></script>
    <script src="js/story-loop.js"></script>

    <script src="js/metrics-tracker.js"></script>
    <script src="js/system-health.js"></script>
    <script src="js/activity-log.js"></script>
</body>
</html>
